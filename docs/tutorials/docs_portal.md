# Туториал: Генерация портала знаний

`agentcall docs portal` собирает управляемые разделы, обучающие материалы и примеры в статический сайт. Портал полезен для обзорных ревью, офлайн-режима и быстрого поиска по документированным решениям.

## 1. Подготовка
- Убедитесь, что архитектурный манифест актуален (`architecture/manifest.yaml` или `.agentcontrol/architecture/manifest.yaml`).
- Проверьте конфигурацию мостика (`.agentcontrol/config/docs.bridge.yaml`); при отсутствии используется дефолтная корневая директория `docs`.
- Синхронизируйте документацию: `agentcall docs repair --json`.

## 2. Генерация портала
```bash
agentcall docs portal --json
# или с кастомным каталогом
agentcall docs portal ~/public/portal --force
```

- По умолчанию портал пишется в `reports/docs/portal`.
- Флаг `--force` очищает целевой каталог перед записью.
- `--budget` задаёт лимит на размер артефактов (по умолчанию 1048576 байт ≈ 1 МиБ).

Успешный запуск возвращает отчёт:
```json
{
  "status": "ok",
  "path": "reports/docs/portal",
  "files": 4,
  "size_bytes": 48211,
  "generated_at": "2025-10-07T12:34:56Z",
  "inventory": {"tutorial": 5, "example": 3}
}
```

## 3. Что внутри портала
- **Managed sections** — HTML-рендер архитектурного обзора, ADR/RFC индексов (данные из манифеста).
- **Docs status** — статус секций из `agentcall docs list` с путями для ручной проверки.
- **Knowledge inventory** — поиск по `docs/tutorials/**` и `examples/**` с краткими описаниями и отметкой времени.
- **Telemetry** — события `docs.portal start/success|error` фиксируют путь, бюджет и итоговый размер.

## 4. Поиск и проверяемость
- Строка поиска фильтрует по заголовкам, описаниям, тегам и путям.
- Каждый результат показывает относительный путь и время модификации (provenance).
- Чтобы открыть исходный материал, используйте `path` как относительный URL внутри репозитория.

## 5. Типичные ошибки
| Код | Причина | Как исправить |
| --- | --- | --- |
| `DOCS_PORTAL_MANIFEST_MISSING` | Не найден архитектурный манифест | Запустите `agentcall run architecture-sync` или создайте `architecture/manifest.yaml`. |
| `DOCS_PORTAL_OUTPUT_NOT_EMPTY` | Целевой каталог содержит посторонние файлы | Укажите пустой каталог или добавьте `--force`. |
| `DOCS_PORTAL_SIZE_BUDGET_EXCEEDED` | Итоговый сайт крупнее бюджета | Повышайте `--budget` или удалите тяжёлые изображения/скрипты. |

## 6. Рекомендации
- Автоматизируйте выпуск портала через CI, публикуя содержимое `reports/docs/portal` в статический хостинг.
- Фиксируйте портал при релизах для прозрачной истории решений.
- Сохраняйте размер сайта ≤ бюджет, чтобы проверка качества (`agentcall verify`) оставалась быстрой.
- Запускайте `agentcall docs lint --knowledge --json --max-age-hours 168` перед релизом — отчёт `reports/docs_coverage.json` и порог устаревания гарантируют, что материалы актуальны.
